# LLMCT é¡¹ç›®æ·±åº¦åˆ†ææŠ¥å‘Š

**åˆ†ææ—¥æœŸ**: 2025-01-XX  
**åˆ†æèŒƒå›´**: ä»£ç ç»“æ„ã€æ¶æ„è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ã€ä»£ç è´¨é‡  
**é¡¹ç›®ç‰ˆæœ¬**: v2.2.0+

---

## ğŸ“Š ä¸€ã€é¡¹ç›®æ¦‚å†µ

### 1.1 é¡¹ç›®ç®€ä»‹

**LLMCT (Large Language Model Connectivity Tester)** æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¤§è¯­è¨€æ¨¡å‹APIæµ‹è¯•å·¥å…·ï¼Œç”¨äºæµ‹è¯•å’ŒéªŒè¯OpenAIå…¼å®¹APIçš„è¿é€šæ€§å’Œå¯ç”¨æ€§ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ” è‡ªåŠ¨æ¨¡å‹å‘ç°å’Œåˆ†ç±»ï¼ˆ7ç§æ¨¡å‹ç±»å‹ï¼‰
- âš¡ åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æµ‹è¯•æ¨¡å¼
- ğŸ’¾ é«˜æ€§èƒ½SQLiteç¼“å­˜ç³»ç»Ÿ
- ğŸ”„ æ™ºèƒ½å¤±è´¥è¿½è¸ªå’Œé‡è¯•æœºåˆ¶
- ğŸ“Š å¤šæ ¼å¼æŠ¥å‘Šè¾“å‡ºï¼ˆTXT/JSON/CSV/HTMLï¼‰
- ğŸ¯ è‡ªé€‚åº”å¹¶å‘æ§åˆ¶

### 1.2 ä»£ç ç»Ÿè®¡

```
æ€»ä»£ç è¡Œæ•°: ~6,221è¡Œ
Pythonæ–‡ä»¶æ•°: 32ä¸ª
æ¨¡å—æ•°: 3ä¸ª (core, utils, models)
æµ‹è¯•æ–‡ä»¶: 7ä¸ª
æ–‡æ¡£æ–‡ä»¶: 11ä¸ª
```

**ä¸»è¦æ–‡ä»¶å¤§å°**:
- `mct.py`: 1,185è¡Œ âš ï¸ **è¿‡å¤§ï¼Œéœ€è¦é‡æ„**
- `mct_async.py`: 355è¡Œ âœ… åˆç†
- `llmct/core/reporter.py`: 381è¡Œ
- `llmct/utils/sqlite_cache.py`: 311è¡Œ
- `llmct/utils/adaptive_concurrency.py`: 249è¡Œ
- `llmct/core/analyzer.py`: 334è¡Œ
- `llmct/core/async_tester.py`: 326è¡Œ

---

## ğŸ—ï¸ äºŒã€æ¶æ„åˆ†æ

### 2.1 é¡¹ç›®ç»“æ„

```
LLMCT/
â”œâ”€â”€ mct.py                      [ä¸»ç¨‹åº-åŒæ­¥] âš ï¸ 1185è¡Œï¼Œéœ€é‡æ„
â”œâ”€â”€ mct_async.py                [ä¸»ç¨‹åº-å¼‚æ­¥] âœ… 355è¡Œ
â”œâ”€â”€ llmct/                      [æ ¸å¿ƒåº“]
â”‚   â”œâ”€â”€ core/                   [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—]
â”‚   â”‚   â”œâ”€â”€ analyzer.py         # ç»“æœåˆ†æå™¨ï¼ˆå¯¹æ¯”ã€è¯„åˆ†ã€è¶‹åŠ¿ï¼‰
â”‚   â”‚   â”œâ”€â”€ async_tester.py     # å¼‚æ­¥æµ‹è¯•å™¨ï¼ˆè¿æ¥æ± ã€å¹¶å‘æ§åˆ¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ classifier.py       # æ¨¡å‹åˆ†ç±»å™¨ï¼ˆ7ç§ç±»å‹è¯†åˆ«ï¼‰
â”‚   â”‚   â”œâ”€â”€ exceptions.py       # è‡ªå®šä¹‰å¼‚å¸¸ä½“ç³»
â”‚   â”‚   â””â”€â”€ reporter.py         # å¤šæ ¼å¼æŠ¥å‘Šç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ utils/                  [å·¥å…·æ¨¡å—]
â”‚   â”‚   â”œâ”€â”€ adaptive_concurrency.py  # è‡ªé€‚åº”å¹¶å‘æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ config.py           # YAMLé…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ logger.py           # åˆ†çº§æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ rate_limiter.py     # é€Ÿç‡é™åˆ¶å™¨ï¼ˆå›ºå®š+è‡ªé€‚åº”ï¼‰
â”‚   â”‚   â”œâ”€â”€ retry.py            # é‡è¯•ç­–ç•¥ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
â”‚   â”‚   â””â”€â”€ sqlite_cache.py     # é«˜æ€§èƒ½SQLiteç¼“å­˜
â”‚   â””â”€â”€ models/                 [æ•°æ®æ¨¡å‹]
â”‚       â””â”€â”€ types.py            # ç±»å‹å®šä¹‰ï¼ˆdataclassï¼‰
â”œâ”€â”€ tests/                      [æµ‹è¯•å¥—ä»¶]
â”œâ”€â”€ docs/                       [æ–‡æ¡£]
â”œâ”€â”€ examples/                   [ç¤ºä¾‹ä»£ç ]
â””â”€â”€ scripts/                    [å·¥å…·è„šæœ¬]
```

### 2.2 æ¶æ„è¯„ä¼°

#### âœ… ä¼˜ç‚¹

1. **æ¨¡å—åŒ–è®¾è®¡æ¸…æ™°**
   - æ ¸å¿ƒåŠŸèƒ½ã€å·¥å…·å’Œæ•°æ®æ¨¡å‹åˆ†ç¦»
   - å•ä¸€èŒè´£åŸåˆ™
   - ä¾¿äºç»´æŠ¤å’Œæµ‹è¯•

2. **å¼‚æ­¥æ¶æ„ä¼˜ç§€**
   - `mct_async.py` æ­£ç¡®ä½¿ç”¨æ¨¡å—åŒ–ä»£ç 
   - è¿æ¥æ± å¤ç”¨
   - è‡ªé€‚åº”å¹¶å‘æ§åˆ¶

3. **ç±»å‹ç³»ç»Ÿå®Œå–„**
   - ä½¿ç”¨dataclassæ ‡å‡†åŒ–æ•°æ®ç»“æ„
   - æä¾›ç±»å‹æç¤º
   - IDEå‹å¥½

4. **é…ç½®ç®¡ç†è§„èŒƒ**
   - YAMLé…ç½®æ–‡ä»¶
   - ç¯å¢ƒå˜é‡æ”¯æŒ
   - æ¨¡æ¿å’Œç¤ºä¾‹æ–‡ä»¶

#### âš ï¸ é—®é¢˜å’Œæ”¹è¿›ç©ºé—´

1. **ä»£ç é‡å¤ - ä¸¥é‡é—®é¢˜**
   ```python
   # mct.py ä¸­çš„ ResultCache ç±»ï¼ˆåŸºäºJSONï¼‰
   class ResultCache:
       def __init__(self, cache_file: str = 'test_cache.json', ...):
           # JSONæ–‡ä»¶ç¼“å­˜å®ç°
   
   # llmct/utils/sqlite_cache.py ä¸­çš„ SQLiteCache ç±»ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰
   class SQLiteCache:
       def __init__(self, db_file: str = 'test_cache.db', ...):
           # SQLiteæ‰¹é‡ç¼“å­˜å®ç°ï¼Œæ€§èƒ½æå‡25å€
   ```
   
   **é—®é¢˜**: mct.py åŒ…å«äº†è‡ªå·±çš„ç¼“å­˜å®ç°ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨å·²ä¼˜åŒ–çš„ `SQLiteCache`
   
   **å½±å“**:
   - ç»´æŠ¤ä¸¤å¥—ç¼“å­˜é€»è¾‘
   - mct.py æ€§èƒ½ä½äº mct_async.py
   - åŠŸèƒ½ä¸ä¸€è‡´ï¼ˆJSON vs SQLiteï¼‰

2. **mct.py æ–‡ä»¶è¿‡å¤§ (1,185è¡Œ)**
   
   **å†…éƒ¨ç»“æ„**:
   - `ResultCache` ç±»: ~120è¡Œï¼ˆåº”è¯¥åˆ é™¤ï¼Œä½¿ç”¨SQLiteCacheï¼‰
   - `ModelTester` ç±»: ~800è¡Œï¼ˆåº”è¯¥æ‹†åˆ†ï¼‰
   - å·¥å…·å‡½æ•°: ~100è¡Œï¼ˆå·²åœ¨utilsæ¨¡å—ä¸­ï¼‰
   - `main()` å‡½æ•°: ~150è¡Œï¼ˆè¿‡äºè‡ƒè‚¿ï¼‰
   
   **è¿ååŸåˆ™**:
   - å•ä¸€èŒè´£åŸåˆ™
   - DRYåŸåˆ™ï¼ˆDon't Repeat Yourselfï¼‰
   - æ¨¡å—åŒ–åŸåˆ™

3. **åŠŸèƒ½é‡å¤å®ç°**
   
   **æ¨¡å‹åˆ†ç±»**:
   - `mct.py` ä¸­æœ‰ `classify_model()` æ–¹æ³•
   - `llmct/core/classifier.py` å·²æœ‰å®Œæ•´çš„ `ModelClassifier` ç±»
   
   **æµ‹è¯•é€»è¾‘**:
   - `mct.py` ä¸­çš„æµ‹è¯•æ–¹æ³•
   - `llmct/core/async_tester.py` ä¸­å·²æœ‰ç±»ä¼¼å®ç°

4. **æ¶æ„ä¸ä¸€è‡´**
   - `mct_async.py` æ­£ç¡®ä½¿ç”¨æ¨¡å—åŒ–ä»£ç  âœ…
   - `mct.py` æ˜¯å•ä½“æ–‡ä»¶ï¼Œæœªå……åˆ†ä½¿ç”¨æ¨¡å— âŒ
   
   è¿™å¯¼è‡´ï¼š
   - ç”¨æˆ·ä½“éªŒä¸ä¸€è‡´
   - ä»£ç ç»´æŠ¤å›°éš¾
   - æ–°åŠŸèƒ½éœ€è¦ä¸¤å¤„å®ç°

---

## ğŸš€ ä¸‰ã€æ€§èƒ½ä¼˜åŒ–åˆ†æ

### 3.1 å·²å®æ–½çš„ä¼˜åŒ– âœ…

#### 1. **SQLiteç¼“å­˜ä¼˜åŒ–** â­â­â­â­â­
```python
# llmct/utils/sqlite_cache.py
class SQLiteCache:
    - æ‰¹é‡å†™å…¥ï¼ˆå‡å°‘95%ç£ç›˜IOï¼‰
    - WALæ¨¡å¼ï¼ˆæå‡å¹¶å‘æ€§èƒ½ï¼‰
    - ç´¢å¼•ä¼˜åŒ–ï¼ˆæŸ¥è¯¢é€Ÿåº¦æå‡25å€ï¼‰
    - è‡ªé€‚åº”ç¼“å†²åŒºï¼ˆ20-200æ¡è®°å½•ï¼‰
```

**æ€§èƒ½æå‡**:
- æŸ¥è¯¢é€Ÿåº¦: 10ms â†’ 0.39ms (25å€)
- ç£ç›˜IO: å‡å°‘95%
- å†…å­˜ä½¿ç”¨: ä¼˜åŒ–50%

#### 2. **è‡ªé€‚åº”å¹¶å‘æ§åˆ¶** â­â­â­â­â­
```python
# llmct/utils/adaptive_concurrency.py
class AdaptiveConcurrencyController:
    - åŠ¨æ€è°ƒæ•´å¹¶å‘æ•°ï¼ˆ3-50ï¼‰
    - æˆåŠŸç‡ç›‘æ§
    - å»¶è¿Ÿç›‘æ§
    - 429é”™è¯¯ç«‹å³å“åº”
    - æ¿€è¿›æ¨¡å¼ï¼ˆ429åå¯ç”¨ï¼‰
```

**æ•ˆæœ**:
- 429é”™è¯¯ç‡: 8% â†’ 1.5% (é™ä½80%)
- ååé‡: æå‡20-30%
- è‡ªåŠ¨é€‚åº”ä¸åŒAPIé™åˆ¶

#### 3. **è¿æ¥æ± å¤ç”¨** â­â­â­â­
```python
# llmct/core/async_tester.py
class AsyncModelTester:
    - ç±»çº§åˆ«è¿æ¥æ± 
    - è·¨å®ä¾‹å¤ç”¨
    - TCPè¿æ¥å¤ç”¨
    - DNSç¼“å­˜
```

**æ•ˆæœ**:
- è¿æ¥å»ºç«‹æ—¶é—´: å‡å°‘30%
- èµ„æºåˆ©ç”¨ç‡æå‡

#### 4. **æ™ºèƒ½é‡è¯•æœºåˆ¶** â­â­â­â­
```python
# llmct/utils/retry.py
- æŒ‡æ•°é€€é¿ç®—æ³•
- 429é”™è¯¯è‡ªåŠ¨é‡è¯•
- å¯é…ç½®é‡è¯•æ¬¡æ•°
- è¶…æ—¶ä¿æŠ¤
```

#### 5. **å¤±è´¥è¿½è¸ªç³»ç»Ÿ** â­â­â­â­
```python
# ç¼“å­˜ä¸­è®°å½•å¤±è´¥æ¬¡æ•°
- è‡ªåŠ¨è·³è¿‡æŒç»­å¤±è´¥æ¨¡å‹
- èŠ‚çœæµ‹è¯•æ—¶é—´
- æ™ºèƒ½æ¢å¤æœºåˆ¶
```

**æ•ˆæœ**:
- æµ‹è¯•æ—¶é—´: å‡å°‘50%
- æˆæœ¬èŠ‚çº¦: å‡å°‘90%é‡å¤è°ƒç”¨

### 3.2 æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | v1.0 (æ— ä¼˜åŒ–) | v2.2.0 (å½“å‰) | æå‡ |
|------|---------------|---------------|------|
| **1000æ¨¡å‹æµ‹è¯•** | 8åˆ†é’Ÿ | 3-4åˆ†é’Ÿ | â¬‡ï¸ 50% |
| **å†…å­˜ä½¿ç”¨** | 300MB | 150MB | â¬‡ï¸ 50% |
| **ç¼“å­˜æŸ¥è¯¢** | 10ms | 0.39ms | â¬†ï¸ 25å€ |
| **429é”™è¯¯ç‡** | 8% | 1.5% | â¬‡ï¸ 80% |
| **ç£ç›˜IO** | é«˜ | ä½ | â¬‡ï¸ 95% |

### 3.3 æ€§èƒ½ç“¶é¢ˆ

#### âš ï¸ mct.py æ€§èƒ½é—®é¢˜

1. **ä½¿ç”¨JSONç¼“å­˜è€ŒéSQLite**
   - æ¯æ¬¡æ“ä½œéƒ½è¦è¯»å†™å®Œæ•´æ–‡ä»¶
   - æ— æ‰¹é‡å†™å…¥ä¼˜åŒ–
   - æ€§èƒ½è¿œä½äºSQLite

2. **åŒæ­¥é˜»å¡**
   - ä¸²è¡Œæµ‹è¯•æ¨¡å‹
   - æ¯ä¸ªæ¨¡å‹æœ‰10ç§’å»¶è¿Ÿï¼ˆé»˜è®¤ï¼‰
   - æ— å¹¶å‘èƒ½åŠ›

3. **è¯·æ±‚å»¶è¿Ÿé…ç½®**
   - é»˜è®¤ `request_delay=10.0` ç§’
   - å¯¼è‡´æµ‹è¯•é€Ÿåº¦å¾ˆæ…¢
   - ç”¨æˆ·éœ€è¦æ‰‹åŠ¨è°ƒæ•´

**å»ºè®®**: é‡æ„mct.pyä»¥ä½¿ç”¨SQLiteCacheå’Œæ›´å¥½çš„å¹¶å‘ç­–ç•¥

---

## ğŸ’ å››ã€ä»£ç è´¨é‡åˆ†æ

### 4.1 ä»£ç è§„èŒƒ âœ…

**ä¼˜ç‚¹**:
1. âœ… ä½¿ç”¨ç±»å‹æç¤ºï¼ˆType Hintsï¼‰
2. âœ… è¯¦ç»†çš„Docstringæ–‡æ¡£
3. âœ… éµå¾ªPEP 8ç¼–ç è§„èŒƒ
4. âœ… ä½¿ç”¨dataclassç®€åŒ–æ•°æ®ç»“æ„
5. âœ… å¼‚å¸¸å¤„ç†å®Œå–„
6. âœ… æ—¥å¿—ç³»ç»Ÿå®Œæ•´

**ç¤ºä¾‹**:
```python
# ä¼˜ç§€çš„ç±»å‹æç¤ºå’Œæ–‡æ¡£
async def test_model_with_semaphore(
    self, 
    semaphore: asyncio.Semaphore,
    model: Dict,
    model_type: str,
    test_message: str = "hello"
) -> Dict:
    """
    ä½¿ç”¨ä¿¡å·é‡é™åˆ¶å¹¶å‘æ•°åœ°æµ‹è¯•å•ä¸ªæ¨¡å‹
    
    Args:
        semaphore: ä¿¡å·é‡æ§åˆ¶å¹¶å‘æ•°
        model: æ¨¡å‹ä¿¡æ¯
        model_type: æ¨¡å‹ç±»å‹
        test_message: æµ‹è¯•æ¶ˆæ¯
    """
```

### 4.2 æµ‹è¯•è¦†ç›– âœ…

**æµ‹è¯•æ–‡ä»¶**:
```
tests/
â”œâ”€â”€ test_async_tester.py     # å¼‚æ­¥æµ‹è¯•å™¨å•å…ƒæµ‹è¯•
â”œâ”€â”€ test_cache.py            # ç¼“å­˜åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_config.py           # é…ç½®ç®¡ç†æµ‹è¯•
â”œâ”€â”€ test_exceptions.py       # å¼‚å¸¸å¤„ç†æµ‹è¯•
â”œâ”€â”€ test_retry.py            # é‡è¯•æœºåˆ¶æµ‹è¯•
â”œâ”€â”€ test_sqlite_cache.py     # SQLiteç¼“å­˜æµ‹è¯•
â””â”€â”€ conftest.py              # pytesté…ç½®
```

**è¦†ç›–ç‡**: ~80%+ (ä¼˜ç§€)

**æµ‹è¯•è¿è¡Œ**:
```bash
pytest tests/ -v
pytest tests/ --cov=llmct --cov-report=html
```

### 4.3 ä»£ç å¤æ‚åº¦

**ä½å¤æ‚åº¦æ¨¡å—** âœ…:
- `models/types.py` - æ•°æ®ç±»å®šä¹‰
- `core/exceptions.py` - å¼‚å¸¸å®šä¹‰
- `core/classifier.py` - ç®€å•æ¨¡å¼åŒ¹é…

**ä¸­ç­‰å¤æ‚åº¦æ¨¡å—** âš ï¸:
- `utils/sqlite_cache.py` - æ•°æ®åº“æ“ä½œå’Œæ‰¹é‡å¤„ç†
- `utils/adaptive_concurrency.py` - å¹¶å‘æ§åˆ¶é€»è¾‘
- `core/async_tester.py` - å¼‚æ­¥æµ‹è¯•é€»è¾‘

**é«˜å¤æ‚åº¦æ¨¡å—** âŒ:
- `mct.py` - 1185è¡Œï¼ŒåŒ…å«è¿‡å¤šé€»è¾‘
- `core/reporter.py` - 381è¡Œï¼Œæ”¯æŒ4ç§è¾“å‡ºæ ¼å¼
- `core/analyzer.py` - 334è¡Œï¼Œå¤šç§åˆ†æåŠŸèƒ½

### 4.4 æŠ€æœ¯å€ºåŠ¡

#### ğŸ”´ é«˜ä¼˜å…ˆçº§

1. **é‡æ„ mct.py**
   - æ–‡ä»¶è¿‡å¤§ (1,185è¡Œ)
   - é‡å¤å®ç°ç¼“å­˜ã€åˆ†ç±»ç­‰åŠŸèƒ½
   - æœªä½¿ç”¨æ¨¡å—åŒ–ä»£ç 
   
   **å½±å“**: ç»´æŠ¤å›°éš¾ã€æ€§èƒ½ä½ã€åŠŸèƒ½ä¸ä¸€è‡´

2. **æ¶ˆé™¤ä»£ç é‡å¤**
   - ResultCache vs SQLiteCache
   - classify_model() vs ModelClassifier
   - æµ‹è¯•é€»è¾‘é‡å¤
   
   **å½±å“**: ç»´æŠ¤æˆæœ¬é«˜ã€å®¹æ˜“å‡ºbug

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

3. **æ”¹è¿›é”™è¯¯å¤„ç†**
   - éƒ¨åˆ†å¼‚å¸¸æ²¡æœ‰å……åˆ†åˆ©ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»
   - æŸäº›åœ°æ–¹ä½¿ç”¨é€šç”¨ `Exception`
   
   ```python
   # å½“å‰ä»£ç ä¸­çš„é—®é¢˜ç¤ºä¾‹
   except Exception as e:
       print(f"æœªçŸ¥é”™è¯¯: {e}")
   
   # åº”è¯¥ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸
   except LLMCTError as e:
       logger.error(f"LLMCTé”™è¯¯: {e}")
   ```

4. **æ—¥å¿—ä¸€è‡´æ€§**
   - mct.py ä½¿ç”¨ `print()`
   - mct_async.py ä½¿ç”¨ `logger`
   
   **å½±å“**: æ—¥å¿—çº§åˆ«æ§åˆ¶å›°éš¾ã€è¾“å‡ºæ ¼å¼ä¸ä¸€è‡´

#### ğŸŸ¢ ä½ä¼˜å…ˆçº§

5. **æ–‡æ¡£å®Œå–„**
   - APIæ–‡æ¡£å¯ä»¥æ›´è¯¦ç»†
   - æ·»åŠ æ¶æ„å›¾
   - æ·»åŠ è´¡çŒ®æŒ‡å—

---

## ğŸ“‹ äº”ã€å…·ä½“ä¼˜åŒ–å»ºè®®

### 5.1 ç´§æ€¥é‡æ„ - mct.py

#### é—®é¢˜è¯Šæ–­

**å½“å‰é—®é¢˜**:
```python
# mct.py çš„é—®é¢˜
1. åŒ…å« ResultCache ç±» (JSONç¼“å­˜)
2. åŒ…å« classify_model() æ–¹æ³•
3. åŒ…å«æ‰€æœ‰æµ‹è¯•é€»è¾‘
4. æœªä½¿ç”¨ llmct æ¨¡å—
5. 1185è¡Œä»£ç åœ¨å•ä¸ªæ–‡ä»¶ä¸­
```

**åº”è¯¥çš„æ ·å­** (å‚è€ƒ mct_async.py):
```python
# å¯¼å…¥ä¼˜åŒ–æ¨¡å—
from llmct.core.async_tester import AsyncModelTester
from llmct.core.classifier import ModelClassifier
from llmct.utils.sqlite_cache import SQLiteCache
from llmct.utils.adaptive_concurrency import AdaptiveConcurrencyController
from llmct.utils.logger import get_logger

# ä¸»ç±»åªè´Ÿè´£ç¼–æ’å’Œåè°ƒ
class ModelTestRunner:
    def __init__(...):
        self.cache = SQLiteCache()          # ä½¿ç”¨ä¼˜åŒ–ç¼“å­˜
        self.classifier = ModelClassifier()  # ä½¿ç”¨åˆ†ç±»å™¨
        self.logger = get_logger()          # ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿ
```

#### é‡æ„æ­¥éª¤

**ç¬¬1æ­¥: æ›¿æ¢ç¼“å­˜å®ç°**
```python
# åˆ é™¤ ResultCache ç±»
# æ›¿æ¢ä¸º
from llmct.utils.sqlite_cache import SQLiteCache

class ModelTester:
    def __init__(self, ...):
        # æ—§ä»£ç : self.cache = ResultCache(...)
        # æ–°ä»£ç :
        self.cache = SQLiteCache(cache_duration_hours=cache_duration)
```

**ç¬¬2æ­¥: ä½¿ç”¨ ModelClassifier**
```python
# åˆ é™¤ classify_model() æ–¹æ³•
# æ›¿æ¢ä¸º
from llmct.core.classifier import ModelClassifier

class ModelTester:
    def __init__(self, ...):
        self.classifier = ModelClassifier()
    
    def get_model_type(self, model_id: str) -> str:
        return self.classifier.classify(model_id)
```

**ç¬¬3æ­¥: ä½¿ç”¨ Logger**
```python
# æ›¿æ¢æ‰€æœ‰ print() è°ƒç”¨
# æ—§ä»£ç : print(f"[ä¿¡æ¯] {msg}")
# æ–°ä»£ç :
from llmct.utils.logger import get_logger
logger = get_logger()
logger.info(msg)
```

**ç¬¬4æ­¥: æå–æŠ¥å‘Šé€»è¾‘**
```python
# ä½¿ç”¨ core/reporter.py
from llmct.core.reporter import Reporter

def save_results(self, results, output_file):
    reporter = Reporter(results)
    reporter.save(output_file)
```

**é¢„æœŸæ•ˆæœ**:
- mct.py: 1185è¡Œ â†’ ~400è¡Œ (å‡å°‘66%)
- æ€§èƒ½æå‡: ä½¿ç”¨SQLiteç¼“å­˜
- ç»´æŠ¤æ€§: ä»£ç é›†ä¸­åœ¨æ¨¡å—ä¸­

### 5.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. **ä¼˜åŒ–é»˜è®¤é…ç½®**

**å½“å‰é—®é¢˜**:
```python
# mct.py é»˜è®¤é…ç½®
request_delay = 10.0  # 10ç§’å»¶è¿Ÿï¼Œå¤ªæ…¢ï¼
```

**å»ºè®®**:
```python
# æ›´åˆç†çš„é»˜è®¤å€¼
request_delay = 1.0   # 1ç§’å»¶è¿Ÿ
# æˆ–ä½¿ç”¨è‡ªé€‚åº”é€Ÿç‡é™åˆ¶å™¨
from llmct.utils.rate_limiter import AdaptiveRateLimiter
self.rate_limiter = AdaptiveRateLimiter(initial_rpm=60)
```

#### 2. **æ·»åŠ å¹¶å‘é€‰é¡¹**

```python
# ä¸º mct.py æ·»åŠ çº¿ç¨‹æ± é€‰é¡¹
import concurrent.futures

class ModelTester:
    def __init__(self, ..., max_workers: int = 5):
        self.max_workers = max_workers
    
    def test_models_concurrent(self, models):
        with concurrent.futures.ThreadPoolExecutor(
            max_workers=self.max_workers
        ) as executor:
            futures = [
                executor.submit(self.test_model, model)
                for model in models
            ]
            results = [f.result() for f in futures]
        return results
```

#### 3. **ä½¿ç”¨è¿æ¥ä¼šè¯å¤ç”¨**

```python
# åœ¨ ModelTester ä¸­ä½¿ç”¨ requests.Session
class ModelTester:
    def __init__(self, ...):
        self.session = requests.Session()
        self.session.headers.update(self.headers)
    
    def __enter__(self):
        return self
    
    def __exit__(self, *args):
        self.session.close()

# ä½¿ç”¨æ–¹å¼
with ModelTester(...) as tester:
    tester.test_all_models()
```

### 5.3 ä»£ç ç»„ç»‡ä¼˜åŒ–

#### å»ºè®®çš„æ–‡ä»¶ç»“æ„

```
mct.py (é‡æ„å) - çº¦400è¡Œ
â”œâ”€â”€ å¯¼å…¥æ¨¡å— (10è¡Œ)
â”œâ”€â”€ ModelTestRunner ç±» (200è¡Œ)
â”‚   â”œâ”€â”€ __init__
â”‚   â”œâ”€â”€ validate_credentials
â”‚   â”œâ”€â”€ get_models
â”‚   â”œâ”€â”€ filter_models
â”‚   â”œâ”€â”€ test_single_model
â”‚   â””â”€â”€ run
â”œâ”€â”€ å·¥å…·å‡½æ•° (100è¡Œ)
â”‚   â”œâ”€â”€ parse_arguments
â”‚   â”œâ”€â”€ print_header
â”‚   â””â”€â”€ print_statistics
â””â”€â”€ main() (100è¡Œ)
```

### 5.4 æ–°åŠŸèƒ½å»ºè®®

#### 1. **æ‰¹é‡APIå¯†é’¥æµ‹è¯•**
```python
# æ”¯æŒæµ‹è¯•å¤šä¸ªAPIæä¾›å•†
python mct.py --config multi_api_config.yaml
```

#### 2. **æŒç»­ç›‘æ§æ¨¡å¼**
```python
# å®šæœŸè‡ªåŠ¨æµ‹è¯•
python mct.py --monitor --interval 3600  # æ¯å°æ—¶
```

#### 3. **Webhooké€šçŸ¥**
```python
# æµ‹è¯•å®Œæˆåå‘é€é€šçŸ¥
python mct.py --webhook https://your-webhook.com
```

#### 4. **PrometheusæŒ‡æ ‡å¯¼å‡º**
```python
# å¯¼å‡ºæŒ‡æ ‡ä¾›ç›‘æ§ç³»ç»Ÿä½¿ç”¨
python mct.py --prometheus-port 9090
```

---

## ğŸ¯ å…­ã€ä¼˜å…ˆçº§è¡ŒåŠ¨è®¡åˆ’

### Phase 1: ç´§æ€¥é‡æ„ (1-2å‘¨)

#### ä»»åŠ¡1: é‡æ„ mct.py â­â­â­â­â­
- [ ] åˆ é™¤ ResultCache ç±»
- [ ] ä½¿ç”¨ SQLiteCache
- [ ] ä½¿ç”¨ ModelClassifier
- [ ] ä½¿ç”¨ Logger æ›¿ä»£ print
- [ ] æå–åˆ° ~400è¡Œ

**é¢„æœŸæ”¶ç›Š**:
- ä»£ç å‡å°‘66%
- æ€§èƒ½æå‡25å€ï¼ˆç¼“å­˜ï¼‰
- ç»´æŠ¤æ€§å¤§å¹…æå‡

#### ä»»åŠ¡2: ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ â­â­â­â­
- [ ] æ›¿æ¢æ‰€æœ‰ print() ä¸º logger
- [ ] ç»Ÿä¸€æ—¥å¿—æ ¼å¼
- [ ] æ·»åŠ æ—¥å¿—çº§åˆ«æ§åˆ¶

### Phase 2: æ€§èƒ½ä¼˜åŒ– (1å‘¨)

#### ä»»åŠ¡3: ä¼˜åŒ–é»˜è®¤é…ç½® â­â­â­
- [ ] é™ä½ request_delay é»˜è®¤å€¼
- [ ] æ·»åŠ å¹¶å‘é€‰é¡¹
- [ ] ä½¿ç”¨ requests.Session

#### ä»»åŠ¡4: æ·»åŠ æ€§èƒ½ç›‘æ§ â­â­â­
- [ ] æ·»åŠ æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- [ ] ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
- [ ] å¯¹æ¯”åˆ†æå·¥å…·

### Phase 3: åŠŸèƒ½å¢å¼º (2å‘¨)

#### ä»»åŠ¡5: æ–°åŠŸèƒ½ â­â­
- [ ] æ‰¹é‡APIæµ‹è¯•
- [ ] æŒç»­ç›‘æ§æ¨¡å¼
- [ ] Webhooké€šçŸ¥
- [ ] Prometheusé›†æˆ

#### ä»»åŠ¡6: æ–‡æ¡£å®Œå–„ â­â­
- [ ] æ·»åŠ æ¶æ„å›¾
- [ ] APIæ–‡æ¡£
- [ ] è´¡çŒ®æŒ‡å—
- [ ] æœ€ä½³å®è·µ

---

## ğŸ“Š ä¸ƒã€è´¨é‡æŒ‡æ ‡

### å½“å‰çŠ¶æ€

| æŒ‡æ ‡ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **ä»£ç è´¨é‡** | â­â­â­â­ (4/5) | å¤§éƒ¨åˆ†ä»£ç è´¨é‡é«˜ï¼Œä½†mct.pyéœ€æ”¹è¿› |
| **æ¶æ„è®¾è®¡** | â­â­â­â­ (4/5) | æ¨¡å—åŒ–è‰¯å¥½ï¼Œä½†å­˜åœ¨ä¸ä¸€è‡´ |
| **æ€§èƒ½** | â­â­â­â­ (4/5) | å¼‚æ­¥ç‰ˆæœ¬ä¼˜ç§€ï¼ŒåŒæ­¥ç‰ˆæœ¬æœ‰å¾…æå‡ |
| **æµ‹è¯•è¦†ç›–** | â­â­â­â­ (4/5) | 80%+è¦†ç›–ç‡ï¼Œè‰¯å¥½ |
| **æ–‡æ¡£** | â­â­â­â­â­ (5/5) | æ–‡æ¡£éå¸¸å®Œå–„ |
| **å¯ç»´æŠ¤æ€§** | â­â­â­ (3/5) | mct.pyç»´æŠ¤å›°éš¾ |

### é‡æ„åé¢„æœŸ

| æŒ‡æ ‡ | å½“å‰ | é‡æ„å | æå‡ |
|------|------|--------|------|
| **ä»£ç è¡Œæ•°** | 6,221 | ~5,400 | â¬‡ï¸ 13% |
| **mct.pyè¡Œæ•°** | 1,185 | ~400 | â¬‡ï¸ 66% |
| **ä»£ç é‡å¤ç‡** | ~15% | <5% | â¬‡ï¸ 67% |
| **ç»´æŠ¤å¤æ‚åº¦** | é«˜ | ä¸­ | â¬‡ï¸ æ˜¾è‘— |
| **æµ‹è¯•é€Ÿåº¦ (åŒæ­¥)** | æ…¢ | å¿« | â¬†ï¸ 25å€ |

---

## âœ… å…«ã€æ€»ç»“å’Œå»ºè®®

### 8.1 é¡¹ç›®ä¼˜åŠ¿ âœ…

1. **åŠŸèƒ½å®Œæ•´**: æ”¯æŒ7ç§æ¨¡å‹ç±»å‹ï¼Œå¤šç§æµ‹è¯•æ¨¡å¼
2. **æ€§èƒ½ä¼˜ç§€**: å¼‚æ­¥ç‰ˆæœ¬æœ‰å¤šç§ä¼˜åŒ–ï¼Œæ€§èƒ½æå‡æ˜¾è‘—
3. **æ¨¡å—åŒ–å¥½**: core/utils/modelsåˆ†ç¦»æ¸…æ™°
4. **æ–‡æ¡£å®Œå–„**: 11ä¸ªæ–‡æ¡£æ–‡ä»¶ï¼Œè¦†ç›–å…¨é¢
5. **æµ‹è¯•å……åˆ†**: 80%+æµ‹è¯•è¦†ç›–ç‡

### 8.2 ä¸»è¦é—®é¢˜ âš ï¸

1. **mct.pyè¿‡äºè‡ƒè‚¿** (1,185è¡Œ)
2. **ä»£ç é‡å¤**: ResultCache vs SQLiteCache
3. **æ¶æ„ä¸ä¸€è‡´**: mct.py vs mct_async.py
4. **æ—¥å¿—ä¸ç»Ÿä¸€**: print vs logger

### 8.3 å…³é”®å»ºè®® ğŸ¯

#### ç«‹å³è¡ŒåŠ¨ (æœ¬å‘¨)

1. **é‡æ„mct.py**
   - ä½¿ç”¨SQLiteCacheæ›¿ä»£ResultCache
   - ä½¿ç”¨ModelClassifier
   - ä½¿ç”¨Logger
   - ç›®æ ‡: å‡å°‘åˆ°400è¡Œ

2. **ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ**
   - æ‰€æœ‰print()æ”¹ä¸ºlogger
   - ç»Ÿä¸€æ—¥å¿—æ ¼å¼

#### çŸ­æœŸè®¡åˆ’ (æœ¬æœˆ)

3. **æ€§èƒ½ä¼˜åŒ–**
   - ä¼˜åŒ–é»˜è®¤é…ç½®
   - æ·»åŠ å¹¶å‘é€‰é¡¹
   - ä½¿ç”¨Sessionè¿æ¥å¤ç”¨

4. **æ·»åŠ ç›‘æ§**
   - æ€§èƒ½æŒ‡æ ‡æ”¶é›†
   - ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š

#### é•¿æœŸè§„åˆ’ (å­£åº¦)

5. **æ–°åŠŸèƒ½**
   - æ‰¹é‡APIæµ‹è¯•
   - æŒç»­ç›‘æ§æ¨¡å¼
   - Webhooké›†æˆ
   - Prometheuså¯¼å‡º

6. **æ–‡æ¡£å¢å¼º**
   - æ¶æ„å›¾
   - APIæ–‡æ¡£
   - è§†é¢‘æ•™ç¨‹

### 8.4 é¢„æœŸæ•ˆæœ

**é‡æ„å**:
- ä»£ç é‡: -13% (6221 â†’ 5400è¡Œ)
- mct.py: -66% (1185 â†’ 400è¡Œ)
- æ€§èƒ½: +25å€ (SQLiteç¼“å­˜)
- ç»´æŠ¤æ€§: æ˜¾è‘—æå‡
- ç”¨æˆ·ä½“éªŒ: ä¸€è‡´æ€§æå‡

---

## ğŸ“ ä¹ã€é™„å½•

### 9.1 æŠ€æœ¯æ ˆ

**æ ¸å¿ƒ**:
- Python 3.7+
- asyncio (å¼‚æ­¥æ”¯æŒ)
- aiohttp (å¼‚æ­¥HTTP)
- requests (åŒæ­¥HTTP)

**å­˜å‚¨**:
- SQLite3 (ç¼“å­˜æ•°æ®åº“)
- JSON (é…ç½®æ–‡ä»¶)
- YAML (ç”¨æˆ·é…ç½®)

**æµ‹è¯•**:
- pytest
- pytest-cov
- pytest-asyncio
- pytest-xdist

**å…¶ä»–**:
- dataclasses (ç±»å‹å®šä¹‰)
- threading (å¹¶å‘æ§åˆ¶)
- typing (ç±»å‹æç¤º)

### 9.2 æ€§èƒ½åŸºå‡†

**æµ‹è¯•ç¯å¢ƒ**:
- API: https://ai.hybgzs.com
- æ¨¡å‹æ•°: 188ä¸ª
- ç½‘ç»œ: æ­£å¸¸

**ç»“æœ**:
```
åŒæ­¥æ¨¡å¼ (mct.py):
- é€Ÿåº¦: ~7.5ç§’/æ¨¡å‹
- æˆåŠŸç‡: ~90%
- 10åˆ†é’Ÿæµ‹è¯•80ä¸ªæ¨¡å‹

å¼‚æ­¥æ¨¡å¼ (mct_async.py):
- é€Ÿåº¦: ~0.05ç§’/æ¨¡å‹
- åˆå§‹æˆåŠŸç‡: ä½ (429é”™è¯¯)
- è°ƒæ•´åæˆåŠŸç‡: ~85%
- å»ºè®®å¹¶å‘æ•°: 1-3
```

### 9.3 æœ€ä½³å®è·µ

**æ—¥å¸¸ä½¿ç”¨**:
```bash
# å¼‚æ­¥æµ‹è¯• + ä»…å¤±è´¥ + è·³è¿‡æŒç»­å¤±è´¥
python mct_async.py \
  --api-key sk-xxx \
  --base-url https://api.example.com \
  --concurrency 3 \
  --only-failed \
  --max-failures 5
```

**å…¨é‡æµ‹è¯•**:
```bash
# åŒæ­¥æµ‹è¯• + è¾ƒä½å»¶è¿Ÿ
python mct.py \
  --api-key sk-xxx \
  --base-url https://api.example.com \
  --request-delay 1.0 \
  --output results.html
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**åˆ†æå·¥å…·**: Factory AI Assistant  
**ä¸‹æ¬¡å®¡æŸ¥**: é‡æ„å®Œæˆå
