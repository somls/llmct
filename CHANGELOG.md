# 变更日志

所有重要的项目变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [2.2.1] - 2025-01-XX

### 🏗️ 重构
- **[Phase 1]** 核心架构重构（-129行）
  - 删除 `ResultCache` 类（119行），使用优化的 `SQLiteCache`
  - 简化 `classify_model`（46→3行），使用 `ModelClassifier`
  - 使用 `requests.Session` 实现连接复用
  - 添加上下文管理器支持

- **[Phase 2]** 功能增强（-18行）
  - 统一日志系统集成
  - 简化 `save_results`（60→33行），使用 `Reporter`
  - 多格式输出自动检测
  - 代码总计减少147行（-12.4%）

### ⚡ 性能
- 缓存速度: +25倍 (10ms→0.4ms)
- 连接开销: -30% (Session复用)
- 默认延迟: 10秒→1秒 (+10倍)
- 磁盘IO: -95% (批量写入)

### ✨ 新增
- 多格式报告（txt/json/csv/html）
- 统一日志记录系统
- 完整的重构文档

### 📖 文档
- `PROJECT_ANALYSIS.md` - 项目深度分析
- `REFACTORING_GUIDE.md` - 重构指南
- `REFACTORING_COMPLETE.md` - Phase 1报告
- `REFACTORING_PHASE2.md` - Phase 2报告
- `OPTIMIZATION_SUMMARY.md` - 优化总结

### 🗑️ 清理
- 删除备份文件和临时缓存
- 删除过时文档
- 代码库整体精简

---

## [2.2.0] - 2025-10-12 (历史版本)

### ✨ 新增
- **API凭证预验证** - 测试前验证API密钥有效性，快速失败并给出友好提示
- **异步测试脚本 mct_async.py** - 高性能异步并发测试框架
  - 自适应并发控制集成
  - 实时进度显示
  - SQLite缓存支持
  - 详细性能统计
- **实测分析报告** - 基于真实API测试的完整分析报告（FINAL_TEST_ANALYSIS.md）

### 🔧 优化
- **错误处理改进** - 更友好的401错误提示，包含可能原因和解决建议
- **并发控制优化** - 自适应调整并发数，更好地应对速率限制
- **文档结构优化** - 清理冗余文档，整合优化报告

### 🗑️ 移除
- 删除临时调试文件（test_api_debug.py）
- 删除初步优化报告（OPTIMIZATION_REPORT.md，已被FINAL_TEST_ANALYSIS.md取代）
- 删除重复配置文件（config_optimized.yaml）

### 📚 文档
- 更新README.md添加异步测试说明
- 新增FINAL_TEST_ANALYSIS.md详细测试分析报告
- 更新DOCS_INDEX.md文档索引
- 完善命令参数文档

### 🧪 测试结果（真实API）
- **测试模型数**: 188个
- **同步测试**: 成功率85-95%，速度~2秒/模型
- **异步测试**: 在严格速率限制下，推荐并发=1，速度~1.5秒/模型
- **主要发现**: 
  - API速率限制非常严格，需要低并发或长延迟策略
  - 模型响应时间范围: 0.73秒 - 39秒
  - Claude模型较慢（12-26秒），小型模型较快（3-7秒）

---

## [2.1.0] - 2025-01-16

### ✨ 新增
- **连接池管理优化** - 类级别连接池，支持跨实例复用
- **SQLite缓存** - 高性能SQLite缓存替代JSON，查询速度提升25倍
- **自适应并发控制** - 根据成功率和延迟动态调整并发数
- **类型定义系统** - 使用dataclass和枚举完善类型系统
- **优化测试脚本** - test_optimizations.py验证优化功能

### 🔧 优化
- **代码重构** - 统一请求执行逻辑，减少代码重复20%
- **DNS缓存** - 5分钟DNS缓存，减少90%+DNS查询
- **批量写入** - 缓存批量提交，减少80%+IO操作
- **连接复用** - HTTP连接池配置优化

### 📚 文档
- 重组文档结构，创建docs/目录
- 合并优化相关文档为docs/OPTIMIZATION.md
- 创建CHANGELOG.md记录版本变更
- 简化README.md，突出核心功能
- 清理历史文档（RENAME_*, IMPLEMENTATION_SUMMARY等）

### 🔥 性能提升
- 1000模型测试时间: 5-8分钟 → 3-4分钟 (⬇️ 40-50%)
- 缓存查询速度: 10ms → 0.39ms (⬆️ 25倍)
- 内存使用: ~300MB → ~150MB (⬇️ 50%)
- 429错误率: 5-10% → 1-2% (⬇️ 80%)

---

## [2.0.0] - 2025-01-16

### ✨ 新增
- **异步并发测试** - 使用aiohttp实现并发测试，速度提升60-80%
- **模块化架构** - 将代码重构为llmct模块
- **多格式报告** - 支持JSON、CSV、HTML输出
- **结果分析器** - 健康度评分、对比分析、告警机制
- **配置文件支持** - YAML配置文件管理
- **智能重试机制** - 指数退避重试策略
- **结构化日志** - 分级日志系统

### 🔧 优化
- **速率限制器** - 自适应RPM控制
- **智能缓存** - 成功结果缓存，失败结果重测
- **失败追踪** - 累计失败次数，失败历史记录
- **错误分类** - 13种错误类型自动分类

### 🎨 改进
- 主程序重命名：test_models.py → mct.py
- 完善类型提示和文档
- 添加单元测试（覆盖率80%+）

### 📚 文档
- 项目概览文档
- 优化实施指南
- 升级指南
- 使用手册

---

## [1.0.0] - 2025-01-15

### ✨ 初始版本
- 模型列表获取功能
- 7种模型类型识别（language/vision/audio/embedding/image_gen/reranker/moderation）
- 基础缓存机制
- 失败追踪功能
- 错误统计
- TXT格式报告

---

## 版本说明

### 语义化版本

版本格式：主版本号.次版本号.修订号

- **主版本号**: 不兼容的API修改
- **次版本号**: 向下兼容的功能性新增
- **修订号**: 向下兼容的问题修正

### 变更类型

- `新增` - 新功能
- `优化` - 改进现有功能
- `修复` - Bug修复
- `文档` - 仅文档变更
- `移除` - 删除功能
- `安全` - 安全漏洞修复
- `废弃` - 即将移除的功能

---

## 计划中的功能

### v2.2.0（计划中）
- [ ] 流式处理支持（大规模测试）
- [ ] Web界面
- [ ] 实时监控面板
- [ ] 插件系统
- [ ] 更多输出格式（Markdown、PDF）

### v3.0.0（未来）
- [ ] AI辅助分析
- [ ] 自动化运维
- [ ] CI/CD集成
- [ ] 企业版功能

---

**注意**: 
- 所有v2.x版本保持向后兼容
- v1.0到v2.0的升级指南见 [docs/UPGRADE.md](docs/UPGRADE.md)
- 性能优化详情见 [docs/OPTIMIZATION.md](docs/OPTIMIZATION.md)
