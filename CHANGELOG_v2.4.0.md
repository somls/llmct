# CHANGELOG - v2.4.0

## ç‰ˆæœ¬ä¿¡æ¯
- **ç‰ˆæœ¬å·**: v2.4.0
- **å‘å¸ƒæ—¥æœŸ**: 2025-11-03
- **ç±»å‹**: Feature Release (åŠŸèƒ½æ›´æ–°)

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨

```bash
# 1. è¿è¡Œæµ‹è¯•ï¼ˆç»“æœè‡ªåŠ¨ä¿å­˜åˆ° test_results/{base_url}/ï¼‰
python mct.py --api-key sk-xxx --base-url https://api.openai.com

# 2. å†æ¬¡è¿è¡Œæµ‹è¯•ä»¥ç§¯ç´¯æ•°æ®
python mct.py --api-key sk-xxx --base-url https://api.openai.com

# 3. æŸ¥çœ‹å†å²ç»Ÿè®¡
python mct.py --analyze test_results/api.openai.com
```

### è¾“å‡ºç¤ºä¾‹

```
æ¨¡å‹åç§°                    | æµ‹è¯•æ¬¡æ•° | æˆåŠŸæ¬¡æ•° | å¤±è´¥æ¬¡æ•° | æˆåŠŸç‡  | å¹³å‡å“åº”æ—¶é—´
----------------------------------------------------------------------------------
gpt-4o                      | 3        | 3        | 0        | 100.0%  |     1.23ç§’
gpt-4o-mini                 | 3        | 3        | 0        | 100.0%  |     0.98ç§’
gpt-3.5-turbo               | 3        | 2        | 1        |  66.7%  |     1.15ç§’
```

## æ–°å¢åŠŸèƒ½

### 1. æŒ‰ Base URL åˆ†ç±»ä¿å­˜æµ‹è¯•ç»“æœ

æµ‹è¯•ç»“æœç°åœ¨ä¼šè‡ªåŠ¨æŒ‰ `base_url` åˆ†ç±»ä¿å­˜åˆ°ç‹¬ç«‹çš„ç›®å½•ä¸­ï¼Œä¾¿äºç®¡ç†å’Œè¿½è¸ªä¸åŒ API æä¾›å•†çš„æµ‹è¯•å†å²ã€‚

**ç‰¹æ€§ï¼š**
- è‡ªåŠ¨åˆ›å»º `test_results/{base_url}/` ç›®å½•ç»“æ„
- æ¯æ¬¡æµ‹è¯•ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶ `test_YYYYMMDD_HHMMSS.{format}`
- URL ä¸­çš„ç‰¹æ®Šå­—ç¬¦è‡ªåŠ¨è½¬æ¢ä¸ºåˆæ³•çš„æ–‡ä»¶å

**ç›®å½•ç»“æ„ç¤ºä¾‹ï¼š**
```
test_results/
â”œâ”€â”€ api.openai.com/
â”‚   â”œâ”€â”€ test_20250103_143022.json
â”‚   â””â”€â”€ test_20250103_150315.json
â””â”€â”€ api.anthropic.com/
    â””â”€â”€ test_20250103_144530.json
```

**ä»£ç å˜æ›´ï¼š**
- `llmct/core/reporter.py`
  - æ–°å¢ `_get_base_url_safe_name()` æ–¹æ³•
  - ä¿®æ”¹ `save_report()` æ–¹æ³•ï¼Œè‡ªåŠ¨åˆ›å»ºç›®å½•å¹¶ç”Ÿæˆæ—¶é—´æˆ³æ–‡ä»¶å
- `mct.py`
  - ä¿®æ”¹ `save_results()` æ–¹æ³•ï¼Œè¿”å›å®é™…ä¿å­˜çš„æ–‡ä»¶è·¯å¾„

### 2. å¤šæ¬¡æµ‹è¯•æˆåŠŸç‡ç»Ÿè®¡

æ–°å¢ `ResultAnalyzer` ç±»çš„åˆ†æåŠŸèƒ½ï¼Œå¯ä»¥ç»Ÿè®¡åŒä¸€ base_url ä¸‹æ¯ä¸ªæ¨¡å‹åœ¨å¤šæ¬¡æµ‹è¯•ä¸­çš„è¡¨ç°ã€‚

**ç»Ÿè®¡æŒ‡æ ‡ï¼š**
- æ€»æµ‹è¯•æ¬¡æ•°
- æˆåŠŸæ¬¡æ•° / å¤±è´¥æ¬¡æ•°
- æˆåŠŸç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
- å¹³å‡å“åº”æ—¶é—´
- é”™è¯¯ä»£ç åˆ†å¸ƒ
- æµ‹è¯•å†å²è®°å½•

**æ–°å¢æ–¹æ³•ï¼š**
- `analyze_by_base_url(base_url_dir)`: åˆ†ææŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æµ‹è¯•ç»“æœ
- `get_model_success_rates(base_url_dir, min_tests)`: è·å–æ¨¡å‹æˆåŠŸç‡æ’å
- `save_base_url_analysis(base_url_dir, output_file)`: ä¿å­˜åˆ†ææŠ¥å‘Š

**ä»£ç å˜æ›´ï¼š**
- `llmct/core/analyzer.py`
  - æ–°å¢ base_url åˆ†æç›¸å…³æ–¹æ³•
  - ä½¿ç”¨ `defaultdict` å’Œ `collections` è¿›è¡Œç»Ÿè®¡

### 3. å‘½ä»¤è¡Œåˆ†æå·¥å…·

æ–°å¢ `--analyze` å‘½ä»¤è¡Œå‚æ•°ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹æŸä¸ª base_url çš„å†å²ç»Ÿè®¡ã€‚

**ç”¨æ³•ï¼š**
```bash
python mct.py --analyze test_results/api.openai.com
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
==================================================
åˆ†æ test_results/api.openai.com ç›®å½•ä¸‹çš„å†å²æµ‹è¯•ç»“æœ
==================================================

æ¨¡å‹åç§°                    | æµ‹è¯•æ¬¡æ•° | æˆåŠŸæ¬¡æ•° | å¤±è´¥æ¬¡æ•° | æˆåŠŸç‡  | å¹³å‡å“åº”æ—¶é—´
-----------------------------------------------------------------------------------------------
gpt-4o                      | 5        | 5        | 0        | 100.0%  |     1.23ç§’
gpt-4o-mini                 | 5        | 5        | 0        | 100.0%  |     0.98ç§’
gpt-3.5-turbo               | 5        | 4        | 1        |  80.0%  |     1.15ç§’
```

**ä»£ç å˜æ›´ï¼š**
- `mct.py`
  - æ–°å¢ `--analyze` å‚æ•°å¤„ç†é€»è¾‘
  - `--api-key` å’Œ `--base-url` å‚æ•°æ”¹ä¸ºéå¿…éœ€ï¼ˆåˆ†ææ¨¡å¼ä¸éœ€è¦ï¼‰
  - æµ‹è¯•å®Œæˆåæ˜¾ç¤ºåˆ†ææç¤ºä¿¡æ¯

## æ”¹è¿›

### æµ‹è¯•åæç¤º

æµ‹è¯•å®Œæˆåä¼šè‡ªåŠ¨æ˜¾ç¤ºæŸ¥çœ‹å†å²ç»Ÿè®¡çš„æç¤ºï¼š

```
[æç¤º] æŸ¥çœ‹è¯¥base_urlçš„å†å²ç»Ÿè®¡ï¼Œè¯·è¿è¡Œ:
  python mct.py --analyze test_results/api.openai.com
```

### é”™è¯¯å¤„ç†

- åˆ†æåŠŸèƒ½å¢å¼ºé”™è¯¯æç¤º
- è‡ªåŠ¨å¤„ç†ç›®å½•ä¸å­˜åœ¨çš„æƒ…å†µ
- ä¼˜é›…å¤„ç†æŸåçš„ JSON æ–‡ä»¶

## æµ‹è¯•

æ–°å¢æµ‹è¯•æ–‡ä»¶ `tests/test_base_url_analysis.py`ï¼ŒåŒ…å«ï¼š
- URL è½¬å®‰å…¨æ–‡ä»¶åæµ‹è¯•
- ç›®å½•åˆ›å»ºæµ‹è¯•
- å¤šæ¬¡æµ‹è¯•ç»Ÿè®¡æµ‹è¯•
- æˆåŠŸç‡æ’åæµ‹è¯•
- åˆ†ææŠ¥å‘Šä¿å­˜æµ‹è¯•

**æµ‹è¯•è¦†ç›–ç‡ï¼š** æ‰€æœ‰æ–°å¢åŠŸèƒ½å‡æœ‰å•å…ƒæµ‹è¯•è¦†ç›–

## æ–‡æ¡£

æ–°å¢æ–‡æ¡£ï¼š
- `docs/base_url_analysis.md`: è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜å’Œä½¿ç”¨æŒ‡å—

## å‘åå…¼å®¹æ€§

- âœ… å®Œå…¨å‘åå…¼å®¹
- æ—§çš„å•æ–‡ä»¶ä¿å­˜æ–¹å¼è¢«æ–°çš„ç›®å½•ç»“æ„æ›¿ä»£
- ç°æœ‰çš„åˆ†æåŠŸèƒ½ï¼ˆ`compare_results`, `calculate_health_score`, `check_alerts`ï¼‰ä¿æŒä¸å˜

## å·²çŸ¥é—®é¢˜

æ— 

## è¿ç§»æŒ‡å—

### ä» v2.3.x è¿ç§»åˆ° v2.4.0

**æ— éœ€ä»»ä½•æ“ä½œ**ï¼Œæ–°ç‰ˆæœ¬å®Œå…¨å‘åå…¼å®¹ã€‚

**å˜åŒ–è¯´æ˜ï¼š**
1. æµ‹è¯•ç»“æœæ–‡ä»¶ä½ç½®å˜åŒ–ï¼š
   - æ—§ç‰ˆæœ¬: `test_results.txt` (å½“å‰ç›®å½•)
   - æ–°ç‰ˆæœ¬: `test_results/{base_url}/test_YYYYMMDD_HHMMSS.txt`

2. å¦‚æœå¸Œæœ›åˆ†ææ—§çš„æµ‹è¯•ç»“æœï¼Œéœ€è¦æ‰‹åŠ¨æ•´ç†ä¸ºæ–°çš„ç›®å½•ç»“æ„ï¼š
   ```bash
   mkdir -p test_results/api.your-provider.com
   mv old_test_results.json test_results/api.your-provider.com/test_20250101_120000.json
   ```

## åº”ç”¨åœºæ™¯

### 1. å®šæœŸç›‘æ§ API å¥åº·åº¦
```bash
# æ¯å°æ—¶è¿è¡Œä¸€æ¬¡æµ‹è¯•
python mct.py --api-key sk-xxx --base-url https://api.openai.com

# å®šæœŸæŸ¥çœ‹ç»Ÿè®¡
python mct.py --analyze test_results/api.openai.com
```

### 2. å¯¹æ¯”å¤šä¸ª API æä¾›å•†
```bash
# æµ‹è¯•ä¸åŒæä¾›å•†
python mct.py --api-key key-a --base-url https://api.provider-a.com
python mct.py --api-key key-b --base-url https://api.provider-b.com

# å¯¹æ¯”åˆ†æ
python mct.py --analyze test_results/api.provider-a.com
python mct.py --analyze test_results/api.provider-b.com
```

### 3. è¯†åˆ«ä¸ç¨³å®šæ¨¡å‹
å…³æ³¨æˆåŠŸç‡ < 90% çš„æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹å¯èƒ½å­˜åœ¨ç¨³å®šæ€§é—®é¢˜ã€‚

## å‚è€ƒæ–‡æ¡£

- ğŸ“– [åŠŸèƒ½è¯¦ç»†æ–‡æ¡£](docs/base_url_analysis.md)
- ğŸ’¡ [ç¤ºä¾‹ä»£ç ](examples/example_base_url_analysis.py)
- ğŸ® [æ¼”ç¤ºè„šæœ¬](examples/demo_v2.4.0.py)
- âœ… [æµ‹è¯•æ–‡ä»¶](tests/test_base_url_analysis.py)
