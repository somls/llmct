# 大模型连通性和可用性测试工具

自动获取并测试所有大模型的连通性和可用性。

## 功能特性

- 自动获取API提供的所有模型列表
- 智能识别语言模型和非语言模型
- 语言模型：发送测试消息并验证响应
- 非语言模型：仅测试连通性
- 显示详细的响应时间
- 实时输出测试结果（边测试边显示）
- 表格化显示，列对齐清晰
- 命令行友好输出

## 环境要求

- Python 3.7+
- Windows 11 / PowerShell
- 网络连接

## 安装

```powershell
# 安装依赖
pip install -r requirements.txt
```

## 使用方法

### 基本用法

```powershell
python test_models.py --api-key <YOUR_API_KEY> --base-url <API_BASE_URL>
```

### 示例

```powershell
# 使用默认测试消息 "hello"，结果保存到test_results.txt
python test_models.py --api-key sk-xxxxxxxx --base-url https://api.openai.com

# 自定义测试消息
python test_models.py --api-key sk-xxxxxxxx --base-url https://api.openai.com --message "你好"

# 设置超时时间
python test_models.py --api-key sk-xxxxxxxx --base-url https://api.openai.com --timeout 60

# 指定输出文件
python test_models.py --api-key sk-xxxxxxxx --base-url https://api.openai.com --output my_results.txt
```

## 参数说明

| 参数 | 必需 | 说明 | 默认值 |
|------|------|------|--------|
| `--api-key` | 是 | API密钥 | - |
| `--base-url` | 是 | API基础URL | - |
| `--message` | 否 | 测试消息 | hello |
| `--timeout` | 否 | 超时时间(秒) | 30 |
| `--output`, `-o` | 否 | 结果输出文件路径 | test_results.txt |

## 输出示例

```
==================================================================================================================
大模型连通性和可用性测试
Base URL: https://api.openai.com
测试时间: 2024-01-01 12:00:00
==================================================================================================================

正在获取模型列表...
共发现 5 个模型

==================================================================================================================
模型名称                                      |  响应时间  |   错误信息   | 响应内容
------------------------------------------------------------------------------------------------------------------
gpt-4                                        |   1.23秒   |      -       | Hello! How can I assist you today?
gpt-3.5-turbo                               |   0.85秒   |      -       | Hi there! How may I help you?
text-embedding-ada-002                      |   0.45秒   |      -       | 连接成功
dall-e-3                                    |  30.00秒   |   TIMEOUT    | -
gpt-4-vision-preview                        |     -      |  HTTP_401    | -
==================================================================================================================
测试完成 | 总计: 5 | 成功: 3 | 失败: 2 | 成功率: 60.0%
==================================================================================================================
```

### 输出说明

- **模型名称**: 显示模型ID，超过45字符会截断
- **响应时间**: 显示秒数，失败时可能显示 -
- **错误信息**: 显示错误代码（TIMEOUT、HTTP_xxx、CONN_FAILED等），成功时显示 -
- **响应内容**: 语言模型显示返回的文本（截断至40字符），非语言模型显示"连接成功"

## 测试结果保存

测试结果会自动保存到文件（默认：`test_results.txt`），文件内容包括：
- 测试基本信息（Base URL、测试时间）
- 完整的测试结果表格
- 统计信息（总计、成功、失败、成功率）

**文件格式示例：**
```
==================================================================================================================
大模型连通性和可用性测试结果
Base URL: https://api.openai.com
测试时间: 2024-01-01 12:00:00
==================================================================================================================

==================================================================================================================
模型名称                                      |  响应时间  |   错误信息   | 响应内容
------------------------------------------------------------------------------------------------------------------
gpt-4                                        |   1.23秒   |      -       | Hello! How can I assist you today?
...
==================================================================================================================
测试完成 | 总计: 5 | 成功: 3 | 失败: 2 | 成功率: 60.0%
==================================================================================================================
```

**注意：** 测试结果文件已添加到 `.gitignore`，不会被提交到版本控制系统。

## 错误说明

测试过程中可能遇到各种错误，详细的错误信息、原因和解决方案请查看 [错误说明文档](ERRORS.md)。

常见错误包括：
- **HTTP_403**: 没有模型访问权限
- **HTTP_429**: 超出速率限制
- **TIMEOUT**: 请求超时
- **CONN_FAILED**: 连接失败

## 注意事项

- 确保API密钥有足够的权限访问模型列表
- 某些API可能有速率限制，大量模型测试时注意间隔
- 超时时间根据网络状况调整
- 测试会产生API调用费用（如果适用）

## 支持的API格式

本工具兼容OpenAI API格式，支持以下端点：
- `/v1/models` - 获取模型列表
- `/v1/chat/completions` - 测试语言模型
- `/v1/models/{model_id}` - 测试非语言模型连通性
